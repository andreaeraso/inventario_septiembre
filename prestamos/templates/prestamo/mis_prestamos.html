{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo }}{% endblock %}

{% block content %}
<style>
/* ===== BASE ===== */
body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background:#f6f8f7;
}

/* ===== PANEL ===== */
.panel-wrapper {
    background: rgba(255,255,255,.9);
    backdrop-filter: blur(6px);
    padding: 2.5rem 2rem;
    border-radius: 18px;
    color: #333;
    box-shadow: 0 10px 35px rgba(0,0,0,.08);
    animation: fadeUp .45s ease both;
}

/* ===== HEADER ===== */
.panel-header {
    border-bottom: 3px solid #0c7c3c;
    padding-bottom: 1rem;
    margin-bottom: 2.2rem;
    text-align: center;
}

.panel-header h3 {
    color: #0c7c3c;
    font-weight: 800;
    font-size: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

/* ===== BUSCADOR ===== */
.buscador-container {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.buscador-input {
    padding: .6rem 1rem;
    border: 1px solid #dcdcdc;
    border-radius: 10px;
    width: 300px;
    max-width: 100%;
    transition: .25s ease;
    background:#fff;
}

.buscador-input:focus {
    border-color: #0c7c3c;
    outline: none;
    box-shadow: 0 0 0 3px rgba(12,124,60,.15);
}

/* ===== CARD PRESTAMOS ===== */
.prestamos-card {
    border-radius: 18px;
    border:none;
    overflow:hidden;
    box-shadow:0 8px 26px rgba(0,0,0,.1);
    animation: fadeUp .45s ease both;
}

.prestamos-card .card-header {
    background:#0c7c3c;
    color:#fff;
    font-weight:700;
    font-size:1.1rem;
    padding:1rem 1.5rem;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}

/* ===== TABLE ===== */
.table th,
.table td {
    vertical-align: middle !important;
    text-align: center;
    font-size: .95rem;
}

.table-hover tbody tr {
    transition:.25s ease;
}

.table-hover tbody tr:hover {
    background:#f3fff7;
}

/* ===== BADGES ===== */
.badge-success {
    background:#0c7c3c;
    color:#fff;
    padding:.45rem .75rem;
    border-radius:10px;
    font-size:.85rem;
    font-weight:600;
}

.badge-warning {
    background:#ffc107;
    color:#222;
    padding:.45rem .75rem;
    border-radius:10px;
    font-size:.85rem;
    font-weight:600;
}

/* ===== MENSAJE VAC√çO ===== */
.mensaje-vacio {
    text-align:center;
    padding:1.4rem;
    color:#777;
    font-size:1rem;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 992px) {

    .table thead {
        display:none;
    }

    .table,
    .table tbody,
    .table tr,
    .table td {
        display:block;
        width:100%;
    }

    .table tr {
        margin-bottom:1.2rem;
        border:1px solid #e0e0e0;
        border-radius:14px;
        box-shadow:0 4px 12px rgba(0,0,0,.06);
        padding:.9rem;
        background:#fff;
    }

    .table td {
        text-align:left;
        padding:.6rem .8rem;
        border:none;
        position:relative;
    }

    .table td::before {
        content: attr(data-label);
        font-weight:600;
        color:#0c7c3c;
        display:block;
        margin-bottom:.25rem;
        font-size:.9rem;
    }

    .buscador-container {
        justify-content:center;
    }

    .panel-wrapper {
        padding:1.3rem;
    }

    .panel-header h3 {
        font-size:1.55rem;
    }

    .prestamos-card .card-header {
        font-size:1rem;
    }
}

@media (max-width: 400px) {
    .buscador-input {
        width:100%;
    }
}

/* ===== ANIMACI√ìN ===== */
@keyframes fadeUp {
    from {
        opacity:0;
        transform:translateY(10px);
    }
    to {
        opacity:1;
        transform:none;
    }
}
</style>


<div class="container-fluid mt-4 px-2">
    <div class="panel-wrapper mx-auto">
        <div class="panel-header">
            <h3><i class='bx bx-time-five'></i> {{ titulo }}</h3>
        </div>

        <!-- üîç Buscador -->
        <div class="buscador-container">
            <input type="text" id="buscador" class="buscador-input" placeholder="Buscar por Id...">
        </div>

        <div class="card prestamos-card">
            <div class="card-header">
                <i class="fas fa-clipboard-list"></i> Mis Pr√©stamos
            </div>
            <div class="card-body table-responsive">
                {% if prestamos %}
                <table class="table table-bordered table-hover align-middle mb-0" id="tablaPrestamos">
                    <thead>
                        <tr>
                            <th> ID Recurso</th>
                            <th><i class='bx bx-cube'></i> Recurso</th>
                            <th><i class='bx bx-buildings'></i> Dependencia</th>
                            <th><i class='bx bx-calendar'></i> Fecha de Pr√©stamo</th>
                            <th><i class='bx bx-calendar-check'></i> Fecha de Devoluci√≥n</th>
                            <th><i class='bx bx-check-shield'></i> Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in prestamos %}
                        <tr>
                            <td data-label="ID Recurso">{{ p.recurso.id }}</td>
                            <td data-label="Recurso">{{ p.recurso.nombre }}</td>
                            <td data-label="Dependencia">{{ p.recurso.dependencia.nombre }}</td>
                            <td data-label="Fecha de Pr√©stamo">{{ p.fecha_prestamo|date:"d/m/Y H:i" }}</td>
                            <td data-label="Fecha de Devoluci√≥n">
                                {% if p.fecha_devolucion %}
                                    {{ p.fecha_devolucion|date:"d/m/Y H:i" }}
                                {% else %}
                                    <em>No registrada</em>
                                {% endif %}
                            </td>
                            <td data-label="Estado">
                                {% if p.devuelto %}
                                    <span class="badge-success"><i class="fas fa-check-circle"></i> Devuelto</span>
                                {% else %}
                                    <span class="badge-warning"><i class="fas fa-hourglass-half"></i> Pendiente</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="mensaje-vacio">
                                <i class='bx bx-info-circle'></i> No tienes pr√©stamos registrados actualmente.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="mensaje-vacio">
                    <i class='bx bx-info-circle'></i> No tienes pr√©stamos registrados actualmente.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- üîé Script de b√∫squeda -->
<script>
    document.getElementById("buscador").addEventListener("keyup", function() {
        const filtro = this.value.toLowerCase();
        const filas = document.querySelectorAll("#tablaPrestamos tbody tr");
        filas.forEach(fila => {
            const recurso = fila.children[0].textContent.toLowerCase();
            fila.style.display = recurso.includes(filtro) ? "" : "none";
        });
    });
</script>
{% endblock %}
